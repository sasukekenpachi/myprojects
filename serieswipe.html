<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>THR: The Ultimate Watchlist</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/hammer.js/2.0.8/hammer.min.js"></script>
    <style>
        :root { --thr-gold: #c6a355; }
        body { background: #050505; overflow: hidden; position: fixed; width: 100%; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; }

        .swiper-container {
            position: relative;
            width: 360px;
            height: 580px;
            perspective: 1200px;
        }

        .card {
            position: absolute;
            width: 100%; height: 100%;
            border-radius: 24px;
            background: #18181b;
            overflow: hidden;
            box-shadow: 0 30px 60px -12px rgba(0, 0, 0, 0.8);
            border: 1px solid #27272a;
            transform-origin: center bottom;
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.1);
        }

        .card-img { height: 70%; width: 100%; object-fit: cover; pointer-events: none; }

        .tag {
            position: absolute; top: 12px; right: 12px;
            background: rgba(0,0,0,0.6); backdrop-filter: blur(4px);
            padding: 4px 10px; border-radius: 6px; font-size: 10px; font-weight: bold;
        }

        .badge {
            position: absolute; top: 50px; padding: 10px 24px;
            border: 5px solid; border-radius: 15px;
            font-weight: 900; font-size: 2.8rem; opacity: 0; z-index: 50;
        }
        .badge-like { border-color: #22c55e; color: #22c55e; left: 30px; transform: rotate(-20deg); }
        .badge-nope { border-color: #ef4444; color: #ef4444; right: 30px; transform: rotate(20deg); }

        /* Smooth reveal for the final list */
        @keyframes popIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .list-item { animation: popIn 0.4s ease forwards; }
    </style>
</head>
<body class="flex flex-col items-center justify-center min-h-screen text-white">

    <div class="mb-6 text-center">
        <h1 class="text-3xl font-black tracking-tighter italic" style="color: var(--thr-gold)">THR <span class="text-white not-italic font-light">MIXER</span></h1>
        <p class="text-zinc-500 text-[9px] uppercase tracking-[0.4em]">2026 New Releases + All-Time Greats</p>
    </div>

    <div id="deck" class="swiper-container">
        <div id="summary-screen" class="hidden absolute inset-0 rounded-2xl p-6 flex flex-col items-center bg-zinc-900/95 backdrop-blur-xl z-[100]">
            <h2 class="text-2xl font-bold mb-4 italic text-yellow-500">YOUR ULTIMATE LIST</h2>
            <div id="watchlist-grid" class="w-full grid grid-cols-2 gap-3 overflow-y-auto max-h-[380px] pr-2 mb-6">
                </div>
            <button onclick="shareList()" class="w-full bg-white text-black font-extrabold py-4 rounded-xl shadow-lg active:scale-95 transition">
                üì§ SHARE TO STORIES
            </button>
        </div>
    </div>

    <div id="controls" class="mt-8 flex gap-10 items-center">
        <button onclick="triggerBtn(false)" class="w-14 h-14 rounded-full bg-zinc-900 border border-zinc-700 text-red-500 shadow-lg">‚úï</button>
        <button onclick="triggerBtn(true)" class="w-14 h-14 rounded-full bg-zinc-900 border border-zinc-700 text-green-500 shadow-lg font-bold">‚ù§</button>
    </div>

    <script>
        const API_KEY = 'cb5d24ec84fde23c28d5627f9fda316a';
        const deck = document.getElementById('deck');
        let watchlist = [];
        let totalRemaining = 0;

        async function init() {
            // Endpoints: Jan 2026 + All Time Classics
            const endpoints = [
                `https://api.themoviedb.org/3/discover/movie?api_key=${API_KEY}&primary_release_date.gte=2026-01-01&primary_release_date.lte=2026-01-31`,
                `https://api.themoviedb.org/3/discover/tv?api_key=${API_KEY}&first_air_date.gte=2026-01-01&first_air_date.lte=2026-01-31`,
                `https://api.themoviedb.org/3/movie/top_rated?api_key=${API_KEY}`,
                `https://api.themoviedb.org/3/tv/top_rated?api_key=${API_KEY}`
            ];

            const responses = await Promise.all(endpoints.map(u => fetch(u).then(r => r.json())));
            
            // Mix 4 from each category for a balanced 16-card deck
            let mixed = [
                ...responses[0].results.slice(0, 4), // 2026 Movies
                ...responses[1].results.slice(0, 4), // 2026 TV
                ...responses[2].results.slice(0, 4), // All-time Movies
                ...responses[3].results.slice(0, 4)  // All-time TV
            ].sort(() => Math.random() - 0.5);

            totalRemaining = mixed.length;
            mixed.forEach(item => createCard(item));
        }

        function createCard(data) {
            const card = document.createElement('div');
            card.className = 'card';
            const title = data.name || data.title;
            const isClassic = new Date(data.release_date || data.first_air_date) < new Date('2025-01-01');

            card.innerHTML = `
                <div class="badge badge-like">KEEP</div>
                <div class="badge badge-nope">SKIP</div>
                <div class="tag ${isClassic ? 'text-yellow-500' : 'text-blue-400'}">${isClassic ? '‚òÖ CLASSIC' : '‚ú® NEW'}</div>
                <img src="https://image.tmdb.org/t/p/w500${data.poster_path}" class="card-img">
                <div class="p-4">
                    <h3 class="font-black text-lg leading-tight">${title}</h3>
                    <p class="text-zinc-500 text-xs mt-1">Rating: ${data.vote_average}/10</p>
                </div>
            `;

            const ham = new Hammer(card);
            ham.get('pan').set({ direction: Hammer.DIRECTION_ALL });

            ham.on('pan', e => {
                if (e.isFinal) {
                    if (Math.abs(e.deltaX) > 130) swipe(card, data, e.deltaX > 0);
                    else { card.style.transform = ''; resetBadges(card); }
                } else {
                    const r = e.deltaX / 12;
                    card.style.transform = `translate(${e.deltaX}px, ${e.deltaY}px) rotate(${r}deg)`;
                    card.querySelector('.badge-like').style.opacity = e.deltaX > 40 ? e.deltaX/140 : 0;
                    card.querySelector('.badge-nope').style.opacity = e.deltaX < -40 ? Math.abs(e.deltaX)/140 : 0;
                }
            });
            deck.appendChild(card);
        }

        function swipe(card, data, liked) {
            if(liked) {
                watchlist.push(data);
                const item = document.createElement('div');
                item.className = "list-item relative h-36 rounded-lg overflow-hidden border border-zinc-800 shadow-md";
                item.innerHTML = `<img src="https://image.tmdb.org/t/p/w300${data.poster_path}" class="w-full h-full object-cover">`;
                document.getElementById('watchlist-grid').appendChild(item);
            }
            card.style.transition = 'transform 0.4s ease-out';
            card.style.transform = `translate(${liked ? 1000 : -1000}px, 0) rotate(${liked ? 40 : -40}deg)`;
            setTimeout(() => { 
                card.remove(); 
                totalRemaining--;
                if(totalRemaining === 0) document.getElementById('summary-screen').classList.remove('hidden');
            }, 300);
        }

        function resetBadges(c) { c.querySelectorAll('.badge').forEach(b => b.style.opacity = 0); }

        function triggerBtn(L) {
            const c = document.querySelectorAll('.card:not(#summary-screen)');
            if(c.length > 0) swipe(c[c.length-1], {}, L);
        }

        async function shareList() {
            const text = `Check out my THR Watchlist! Featuring classics and 2026 releases: ${watchlist.map(i => i.title || i.name).slice(0,3).join(', ')}...`;
            if (navigator.share) navigator.share({ title: 'My THR Picks', text, url: location.href });
            else alert("Watchlist copied to clipboard!");
        }

        init();
    </script>
</body>
</html>